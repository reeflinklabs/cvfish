<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>New Job - CVFish</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/daisyui/dist/full.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Nunito:wght@1000&family=Poppins:wght@500&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="output.css" />
  </head>
  <body class="font-body bg-base-100 min-h-screen">
    <header class="bg-primary text-white p-4">
      <div class="max-w-4xl mx-auto flex justify-between items-center">
        <h1 class="text-2xl font-header">
          <a href="dashboard.html">CVFish</a>
        </h1>
        <button id="logoutButton" class="btn">
          <span class="material-icons mr-2">logout</span>Logout
        </button>
      </div>
    </header>
    <main class="flex items-center justify-center p-4">
      <div class="max-w-lg mx-auto text-left">
        <h1 class="text-5xl font-header mb-4">Add New Job</h1>
        <form id="newJobForm">
          <div class="mb-4 flex gap-4">
            <input
              class="input input-bordered w-1/2"
              type="text"
              id="jobTitle"
              placeholder="Job Title"
              required
            />
            <input
              class="input input-bordered w-1/2"
              type="text"
              id="company"
              placeholder="Company"
              required
            />
          </div>
          <div class="mb-4 flex gap-4">
            <select class="select select-bordered w-1/2" id="jobType" required>
              <option value="" disabled selected>Job Type</option>
              <option value="internship">Internship</option>
              <option value="gradscheme">Grad Scheme</option>
              <option value="fulltime">Full-Time</option>
              <option value="speculative">Speculative</option>
            </select>
            <select class="select select-bordered w-1/2" id="status" required>
              <option value="" disabled selected>Status</option>
              <option value="incomplete">Incomplete</option>
              <option value="submitted cv">Submitted CV</option>
              <option value="submitted assessment">Submitted Assessment</option>
              <option value="submitted interview">Submitted Interview</option>
              <option value="rejected at cv">Rejected at CV</option>
              <option value="rejected at assessment">
                Rejected at Assessment
              </option>
              <option value="rejected at interview">
                Rejected at Interview
              </option>
              <option value="rejected">Rejected</option>
              <option value="offer">Offer</option>
            </select>
          </div>
          <div class="mb-4">
            <input
              class="input input-bordered w-full"
              type="date"
              id="dateApplied"
              placeholder="Date Applied"
              required
            />
          </div>
          <div class="mb-4">
            <textarea
              class="textarea textarea-bordered w-full"
              id="jobDescription"
              rows="4"
              placeholder="Job Description"
              required
            ></textarea>
          </div>
          <div class="flex items-center justify-between">
            <button
              id="createJobButton"
              class="btn btn-primary w-full flex items-center"
              type="submit"
            >
              <span class="material-icons mr-2">add</span>Create Job
            </button>
            <div
              id="spinner"
              class="hidden ml-4 spinner-border animate-spin inline-block w-8 h-8 border-4 rounded-full text-blue-600"
              role="status"
            >
              <span class="visually-hidden">Loading...</span>
            </div>
          </div>
        </form>
      </div>
    </main>
    <script src="script.js"></script>
    <script>
      document
        .getElementById("newJobForm")
        .addEventListener("submit", async (event) => {
          event.preventDefault();
          const jobTitle = document.getElementById("jobTitle").value;
          const jobDescription =
            document.getElementById("jobDescription").value;
          const company = document.getElementById("company").value;
          const jobType = document.getElementById("jobType").value;
          const status = document.getElementById("status").value;
          const dateApplied = document.getElementById("dateApplied").value;
          const createJobButton = document.getElementById("createJobButton");
          const spinner = document.getElementById("spinner");

          createJobButton.disabled = true;
          spinner.classList.remove("hidden");

          try {
            const data = await makeFetchRequest("/v1/jobs", {
              method: "POST",
              body: JSON.stringify({
                title: jobTitle,
                description: jobDescription,
                company,
                jobType,
                status,
                dateApplied,
              }),
            });

            console.log("Job created:", data);
            window.location.href = "dashboard.html";
          } catch (error) {
            console.error("Error creating job:", error);
            alert("Error creating job. Please try again.");
            createJobButton.disabled = false;
            spinner.classList.add("hidden");
          }
        });

      document
        .getElementById("logoutButton")
        .addEventListener("click", logoutUser);
    </script>
  </body>
</html>
