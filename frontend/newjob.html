<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>New Job - CVFish</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/daisyui/dist/full.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Nunito:wght@1000&family=Poppins:wght@500&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="output.css" />
  </head>
  <body class="font-body bg-base-300 min-h-screen">
    <header class="bg-primary text-white p-4">
      <div class="max-w-4xl mx-auto flex justify-between items-center">
        <h1 class="text-2xl font-header">
          <a href="dashboard.html">CVFish</a>
        </h1>
        <button id="logoutButton" class="btn">
          <span class="material-icons mr-2">logout</span>Logout
        </button>
      </div>
    </header>
    <main class="flex flex-col items-start p-4">
      <div class="max-w-4xl w-full mx-auto p-8 rounded shadow-md text-left">
        <button class="btn btn-circle">
          <a href="dashboard.html"
            ><span class="material-icons mr-2">arrow_back</span></a
          >
        </button>
        <h1 class="text-5xl font-header mb-4">Add New Job</h1>
        <div class="card bg-base-100 p-4 shadow-md w-full">
          <form id="newJobForm">
            <div class="mb-4">
              <label class="block text-lg mb-2" for="jobTitle">Job Title</label>
              <input
                class="input input-bordered w-full"
                type="text"
                id="jobTitle"
                placeholder="Software Engineer"
                required
              />
            </div>
            <div class="mb-4">
              <label class="block text-lg mb-2" for="company">Company</label>
              <input
                class="input input-bordered w-full"
                type="text"
                id="company"
                placeholder="Google"
                required
              />
            </div>
            <div class="mb-4 flex gap-4">
              <div class="w-1/2">
                <label class="block text-lg mb-2" for="jobType">Job Type</label>
                <select
                  class="select select-bordered w-full"
                  id="jobType"
                  required
                >
                  <option value="" disabled selected>Select Type</option>
                  <option value="internship">Internship</option>
                  <option value="gradscheme">Grad Scheme</option>
                  <option value="fulltime">Full-Time</option>
                  <option value="speculative">Speculative</option>
                </select>
              </div>
              <div class="w-1/2">
                <label class="block text-lg mb-2" for="status">Status</label>
                <select
                  class="select select-bordered w-full"
                  id="status"
                  required
                >
                  <option value="" disabled selected>Select Status</option>
                  <option value="incomplete">Incomplete</option>
                  <option value="submitted cv">Submitted CV</option>
                  <option value="submitted assessment">
                    Submitted Assessment
                  </option>
                  <option value="submitted interview">
                    Submitted Interview
                  </option>
                  <option value="rejected at cv">Rejected at CV</option>
                  <option value="rejected at assessment">
                    Rejected at Assessment
                  </option>
                  <option value="rejected at interview">
                    Rejected at Interview
                  </option>
                  <option value="rejected">Rejected</option>
                  <option value="offer">Offer</option>
                </select>
              </div>
            </div>
            <div class="mb-4">
              <label class="block text-lg mb-2" for="dateApplied"
                >Application Deadline</label
              >
              <input
                class="input input-bordered w-full"
                type="date"
                id="dateApplied"
                required
              />
            </div>
            <div class="mb-4">
              <label class="block text-lg mb-2" for="jobDescription"
                >Job Description</label
              >
              <textarea
                class="textarea textarea-bordered w-full"
                id="jobDescription"
                rows="4"
                placeholder="Describe the job role and responsibilities."
                required
              ></textarea>
            </div>
            <div class="flex items-center justify-between">
              <button
                id="createJobButton"
                class="btn btn-primary w-full flex items-center"
                type="submit"
              >
                <span class="material-icons mr-2">add</span>Create Job
              </button>
              <div
                id="spinner"
                class="hidden ml-4 spinner-border animate-spin inline-block w-8 h-8 border-4 rounded-full text-blue-600"
                role="status"
              >
                <span class="visually-hidden">Loading...</span>
              </div>
            </div>
          </form>
        </div>
      </div>
    </main>
    <footer class="footer footer-center bg-base-100 text-base-content p-10">
      <nav class="grid grid-flow-col gap-4">
        <a class="link link-hover" href="about.html">About</a>
        <a class="link link-hover" href="cv.html">Create CV</a>
      </nav>
      <aside>
        <p class="text-sm">
          Made with ❤️ & ☕️ by <a href="https://marcbeep.com"><u>Marc</u></a>
        </p>
        <p class="text-xs">
          © 2024
          <a href="https://reeflinklabs.com"><u>ReefLink Labs Limited</u></a
          >, Registered in England and Wales (15783465)<br />
          49 Jamaica Street, Liverpool, England, L1 0AH
        </p>
      </aside>
    </footer>
    <script src="script.js"></script>
    <script>
      document
        .getElementById("newJobForm")
        .addEventListener("submit", async (event) => {
          event.preventDefault();
          const jobTitle = document.getElementById("jobTitle").value;
          const jobDescription =
            document.getElementById("jobDescription").value;
          const company = document.getElementById("company").value;
          const jobType = document.getElementById("jobType").value;
          const status = document.getElementById("status").value;
          const dateApplied = document.getElementById("dateApplied").value;
          const createJobButton = document.getElementById("createJobButton");
          const spinner = document.getElementById("spinner");

          createJobButton.disabled = true;
          spinner.classList.remove("hidden");

          try {
            const data = await makeFetchRequest("/v1/jobs", {
              method: "POST",
              body: JSON.stringify({
                title: jobTitle,
                description: jobDescription,
                company,
                jobType,
                status,
                dateApplied,
              }),
            });

            console.log("Job created:", data);
            window.location.href = "dashboard.html";
          } catch (error) {
            console.error("Error creating job:", error);
            alert("Error creating job. Please try again.");
            createJobButton.disabled = false;
            spinner.classList.add("hidden");
          }
        });

      document
        .getElementById("logoutButton")
        .addEventListener("click", logoutUser);
    </script>
  </body>
</html>
